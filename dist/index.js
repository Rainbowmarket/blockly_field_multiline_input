!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("blockly/core"));else if("function"==typeof define&&define.amd)define(["blockly/core"],e);else{var i="object"==typeof exports?e(require("blockly/core")):e(t.Blockly);for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}(this,(t=>(()=>{"use strict";var e={370:e=>{e.exports=t}},i={};function n(t){var l=i[t];if(void 0!==l)return l.exports;var s=i[t]={exports:{}};return e[t](s,s.exports,n),s.exports}n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var l={};n.r(l),n.d(l,{FieldMultilineInput:()=>r});var s=n(370);class r extends s.FieldTextInput{constructor(t,e,i){super(s.Field.SKIP_SETUP),t!==s.Field.SKIP_SETUP&&(i&&this.configure_(i),this.setValue(t),e&&this.setValidator(e),this.textGroup=null,this.maxLines_=1/0,this.isOverflowedY_=!1)}configure_(t){super.configure_(t),t.maxLines&&this.setMaxLines(t.maxLines)}toXml(t){return t.textContent=this.getValue().replace(/\n/g,"&#10;"),t}fromXml(t){this.setValue(t.textContent.replace(/&#10;/g,"\n"))}saveState(){const t=this.saveLegacyState(r);return null!==t?t:this.getValue()}loadState(t){this.loadLegacyState(s.Field,t)||this.setValue(t)}initView(){this.createBorderRect_(),this.textGroup=s.utils.dom.createSvgElement(s.utils.Svg.G,{class:"blocklyEditableText"},this.fieldGroup_)}getDisplayText_(){const t=this.getSourceBlock();if(!t)throw new Error("The field has not yet been attached to its input. Call appendField to attach it.");let e=this.getText();if(!e)return s.Field.NBSP;const i=e.split("\n");e="";const n=this.isOverflowedY_?this.maxLines_:i.length;for(let t=0;t<n;t++){let l=i[t];l.length>this.maxDisplayLength?l=l.substring(0,this.maxDisplayLength-4)+"...":this.isOverflowedY_&&t===n-1&&(l=l.substring(0,l.length-3)+"..."),l=l.replace(/\s/g,s.Field.NBSP),e+=l,t!==n-1&&(e+="\n")}return t.RTL&&(e+="‏"),e}doValueUpdate_(t){super.doValueUpdate_(t),null!==this.value_&&(this.isOverflowedY_=this.value_.split("\n").length>this.maxLines_)}render_(){const t=this.getSourceBlock();if(!t)throw new Error("The field has not yet been attached to its input. Call appendField to attach it.");let e;const i=this.textGroup;for(;e=i.firstChild;)i.removeChild(e);const n=this.getConstants();if(!n)throw Error("Constants not found");const l=this.getDisplayText_().split("\n");let r=0;for(let t=0;t<l.length;t++){const e=n.FIELD_TEXT_HEIGHT+n.FIELD_BORDER_RECT_Y_PADDING;s.utils.dom.createSvgElement(s.utils.Svg.TEXT,{class:"blocklyText blocklyMultilineText",x:n.FIELD_BORDER_RECT_X_PADDING,y:r+n.FIELD_BORDER_RECT_Y_PADDING,dy:n.FIELD_TEXT_BASELINE},i).appendChild(document.createTextNode(l[t])),r+=e}if(this.isBeingEdited_){const t=this.htmlInput_;this.isOverflowedY_?s.utils.dom.addClass(t,"blocklyHtmlTextAreaInputOverflowedY"):s.utils.dom.removeClass(t,"blocklyHtmlTextAreaInputOverflowedY")}if(this.updateSize_(),this.isBeingEdited_){t.RTL?setTimeout(this.resizeEditor_.bind(this),0):this.resizeEditor_();const e=this.htmlInput_;this.isTextValid_?(s.utils.dom.removeClass(e,"blocklyInvalidInput"),s.utils.aria.setState(e,s.utils.aria.State.INVALID,!1)):(s.utils.dom.addClass(e,"blocklyInvalidInput"),s.utils.aria.setState(e,s.utils.aria.State.INVALID,!0))}}updateSize_(){const t=this.getConstants();if(!t)throw Error("Constants not found");const e=this.textGroup.childNodes,i=t.FIELD_TEXT_FONTSIZE,n=t.FIELD_TEXT_FONTWEIGHT,l=t.FIELD_TEXT_FONTFAMILY;let r=0,o=0;for(let u=0;u<e.length;u++){const a=e[u],_=s.utils.dom.getFastTextWidth(a,i,n,l);_>r&&(r=_),o+=t.FIELD_TEXT_HEIGHT+(u>0?t.FIELD_BORDER_RECT_Y_PADDING:0)}if(this.isBeingEdited_){const t=String(this.value_).split("\n"),e=s.utils.dom.createSvgElement(s.utils.Svg.TEXT,{class:"blocklyText blocklyMultilineText"});for(let o=0;o<t.length;o++){t[o].length>this.maxDisplayLength&&(t[o]=t[o].substring(0,this.maxDisplayLength)),e.textContent=t[o];const u=s.utils.dom.getFastTextWidth(e,i,n,l);u>r&&(r=u)}const o=this.htmlInput_;r+=o.offsetWidth-o.clientWidth}this.borderRect_&&(o+=2*t.FIELD_BORDER_RECT_Y_PADDING,r+=2*t.FIELD_BORDER_RECT_X_PADDING+1,this.borderRect_.setAttribute("width",`${r}`),this.borderRect_.setAttribute("height",`${o}`)),this.size_={width:r,height:o},this.positionBorderRect_()}showEditor_(t,e){super.showEditor_(t,e),this.forceRerender()}widgetCreate_(){const t=s.WidgetDiv.getDiv(),e=this.workspace_.getScale(),i=this.getConstants();if(!i)throw Error("Constants not found");const n=document.createElement("textarea");n.className="blocklyHtmlInput blocklyHtmlTextAreaInput",n.setAttribute("spellcheck",String(this.spellcheck_));const l=i.FIELD_TEXT_FONTSIZE*e+"pt";t.style.fontSize=l,n.style.fontSize=l;const r=s.FieldTextInput.BORDERRADIUS*e+"px";n.style.borderRadius=r;const o=i.FIELD_BORDER_RECT_X_PADDING*e,u=i.FIELD_BORDER_RECT_Y_PADDING*e/2;n.style.padding=`${u}px ${o}px ${u}px ${o}px`;const a=i.FIELD_TEXT_HEIGHT+i.FIELD_BORDER_RECT_Y_PADDING;return n.style.lineHeight=a*e+"px",t.appendChild(n),n.value=n.defaultValue=this.getEditorText_(this.value_),n.setAttribute("data-untyped-default-value",String(this.value_)),n.setAttribute("data-old-value",""),s.utils.userAgent.GECKO?setTimeout(this.resizeEditor_.bind(this),0):this.resizeEditor_(),this.bindInputEvents_(n),n}setMaxLines(t){"number"==typeof t&&t>0&&t!==this.maxLines_&&(this.maxLines_=t,this.forceRerender())}getMaxLines(){return this.maxLines_}onHtmlInputKeyDown_(t){"Enter"!==t.key&&super.onHtmlInputKeyDown_(t)}static fromJson(t){return new this(s.utils.parsing.replaceMessageReferences(t.text),void 0,t)}}s.Css.register("\n  .blocklyHtmlTextAreaInput {\n    font-family: monospace;\n    resize: none;\n    overflow: hidden;\n    height: 100%;\n    text-align: left;\n  }\n\n  .blocklyHtmlTextAreaInputOverflowedY {\n    overflow-y: scroll;\n  }\n");const o={init:function(){this.appendDummyInput("NAME").appendField(new r("Enter \n new text here"),"NAME"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setTooltip(""),this.setHelpUrl(""),this.setColour(300)}},u={init:function(){this.appendDummyInput("NAME").appendField(new r("Enter \n new text here"),"NAME"),this.setOutput(!0,null),this.setTooltip(""),this.setHelpUrl(""),this.setColour(300)}};return s.JavaScript.forBlock.multiple_line_input_in=function(t){return[`'${t.getFieldValue("TEXT").replace(/\n/g,"\\n").replace(/'/g,"\\'")}'`,s.JavaScript.ORDER_ATOMIC]},s.JavaScript.forBlock.multiple_line_input_out=function(t){return`'${t.getFieldValue("TEXT").replace(/\n/g,"\\n").replace(/'/g,"\\'")}'`},s.PHP.multiple_line_input_in=function(t){return[`'${t.getFieldValue("TEXT").replace(/\n/g,"\\n")}'`,s.PHP.ORDER_ATOMIC]},s.PHP.multiple_line_input_out=function(t){return`'${t.getFieldValue("TEXT").replace(/\n/g,"\\n")}'`},s.Dart.multiple_line_input_in=function(t){return[`'${t.getFieldValue("TEXT").replace(/\n/g,"\\n")}'`,s.Dart.ORDER_ATOMIC]},s.Dart.multiple_line_input_out=function(t){return`'${t.getFieldValue("TEXT").replace(/\n/g,"\\n")}'`},s.Python.multiple_line_input_in=function(t){return[`'''${t.getFieldValue("TEXT").replace(/'''/g,"\\'''")}'''`,s.Python.ORDER_ATOMIC]},s.Python.multiple_line_input_out=function(t){return`'''${t.getFieldValue("TEXT").replace(/'''/g,"\\'''")}'''`},s.Lua.multiple_line_input_in=function(t){return[`'${t.getFieldValue("TEXT").replace(/\n/g,"\\n")}'`,s.Lua.ORDER_ATOMIC]},s.Lua.multiple_line_input_out=function(t){return`'${t.getFieldValue("TEXT").replace(/\n/g,"\\n")}'`},s.registry.hasItem(s.registry.Type.FIELD,"field_multiline_input")||s.registry.register(s.registry.Type.FIELD,"field_multiline_input",r),s.common.defineBlocks({multiple_line_input_in:o,multiple_line_input_out:u}),l})()));
//# sourceMappingURL=index.js.map